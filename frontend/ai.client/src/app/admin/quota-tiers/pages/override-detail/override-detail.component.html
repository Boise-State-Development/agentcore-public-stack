<div class="min-h-dvh bg-gray-100 dark:bg-gray-900">
  <div class="mx-auto max-w-4xl px-4 py-8 sm:px-6 lg:px-8">
    <!-- Page Header -->
    <div class="mb-8">
      <h1 class="text-3xl/9 font-bold text-gray-900 dark:text-white">{{ pageTitle() }}</h1>
      <p class="mt-2 text-base/7 text-gray-600 dark:text-gray-400">
        @if (isEditMode()) {
          Update override expiry date, status, or reason
        } @else {
          Create a temporary quota exception for a specific user
        }
      </p>
    </div>

    <!-- Error Display -->
    @if (error()) {
      <div class="mb-6 rounded-sm border border-red-200 bg-red-50 p-4 dark:border-red-800 dark:bg-red-900/20">
        <p class="text-sm/6 text-red-800 dark:text-red-300">{{ error() }}</p>
      </div>
    }

    <!-- Form -->
    <form [formGroup]="overrideForm" (ngSubmit)="onSubmit()" class="space-y-8">
      <!-- User Selection -->
      <div class="rounded-sm border border-gray-200 bg-white p-6 dark:border-gray-700 dark:bg-gray-800">
        <h2 class="mb-6 text-lg/7 font-semibold text-gray-900 dark:text-white">User</h2>

        <div>
          <label for="userId" class="block text-sm/6 font-medium text-gray-700 dark:text-gray-300">
            User ID <span class="text-red-500">*</span>
          </label>
          <input
            type="text"
            id="userId"
            formControlName="userId"
            placeholder="e.g., user-123, auth0|abc123"
            class="mt-1 block w-full rounded-sm border border-gray-300 bg-white px-3 py-2 text-sm/6 text-gray-900 placeholder:text-gray-400 focus:border-blue-500 focus:outline-hidden focus:ring-3 focus:ring-blue-500/50 disabled:cursor-not-allowed disabled:bg-gray-50 disabled:text-gray-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:placeholder:text-gray-500 dark:disabled:bg-gray-800"
          />
          @if (overrideForm.controls.userId.invalid && overrideForm.controls.userId.touched) {
            <p class="mt-2 text-sm/6 text-red-600 dark:text-red-400">User ID is required</p>
          }
          @if (isEditMode()) {
            <p class="mt-2 text-sm/6 text-gray-600 dark:text-gray-400">User ID cannot be changed after creation</p>
          }
        </div>
      </div>

      <!-- Override Type & Limits -->
      <div class="rounded-sm border border-gray-200 bg-white p-6 dark:border-gray-700 dark:bg-gray-800">
        <h2 class="mb-6 text-lg/7 font-semibold text-gray-900 dark:text-white">Override Type & Limits</h2>

        <div class="space-y-6">
          <!-- Override Type -->
          <div>
            <label class="block text-sm/6 font-medium text-gray-700 dark:text-gray-300">
              Override Type <span class="text-red-500">*</span>
            </label>
            <div class="mt-3 space-y-3">
              <label class="flex items-start">
                <input
                  type="radio"
                  formControlName="overrideType"
                  value="custom_limit"
                  [disabled]="isEditMode()"
                  class="mt-1 size-4 border-gray-300 text-blue-600 focus:ring-3 focus:ring-blue-500/50 disabled:cursor-not-allowed disabled:opacity-50 dark:border-gray-600 dark:bg-gray-700"
                />
                <span class="ml-3">
                  <span class="block text-sm/6 font-medium text-gray-900 dark:text-white">Custom Limit</span>
                  <span class="block text-sm/6 text-gray-600 dark:text-gray-400">
                    Set specific monthly and/or daily cost limits
                  </span>
                </span>
              </label>
              <label class="flex items-start">
                <input
                  type="radio"
                  formControlName="overrideType"
                  value="unlimited"
                  [disabled]="isEditMode()"
                  class="mt-1 size-4 border-gray-300 text-blue-600 focus:ring-3 focus:ring-blue-500/50 disabled:cursor-not-allowed disabled:opacity-50 dark:border-gray-600 dark:bg-gray-700"
                />
                <span class="ml-3">
                  <span class="block text-sm/6 font-medium text-gray-900 dark:text-white">Unlimited</span>
                  <span class="block text-sm/6 text-gray-600 dark:text-gray-400">
                    Remove all quota limits for this user
                  </span>
                </span>
              </label>
            </div>
            @if (isEditMode()) {
              <p class="mt-3 text-sm/6 text-gray-600 dark:text-gray-400">
                Override type cannot be changed after creation
              </p>
            }
          </div>

          <!-- Custom Limits (conditional) -->
          @if (selectedType() === 'custom_limit') {
            <div class="space-y-6 rounded-sm border border-blue-200 bg-blue-50 p-4 dark:border-blue-800 dark:bg-blue-900/20">
              <!-- Monthly Cost Limit -->
              <div>
                <label for="monthlyCostLimit" class="block text-sm/6 font-medium text-gray-700 dark:text-gray-300">
                  Monthly Cost Limit (USD) <span class="text-red-500">*</span>
                </label>
                <input
                  type="number"
                  id="monthlyCostLimit"
                  formControlName="monthlyCostLimit"
                  step="0.01"
                  min="0"
                  placeholder="0.00"
                  [disabled]="isEditMode()"
                  class="mt-1 block w-full rounded-sm border border-gray-300 bg-white px-3 py-2 text-sm/6 text-gray-900 placeholder:text-gray-400 focus:border-blue-500 focus:outline-hidden focus:ring-3 focus:ring-blue-500/50 disabled:cursor-not-allowed disabled:bg-gray-50 disabled:text-gray-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:placeholder:text-gray-500 dark:disabled:bg-gray-800"
                />
                @if (overrideForm.controls.monthlyCostLimit.invalid && overrideForm.controls.monthlyCostLimit.touched) {
                  <p class="mt-2 text-sm/6 text-red-600 dark:text-red-400">
                    @if (overrideForm.controls.monthlyCostLimit.errors?.['required']) {
                      Monthly cost limit is required for custom limit type
                    } @else {
                      Monthly cost limit must be 0 or greater
                    }
                  </p>
                }
                @if (isEditMode()) {
                  <p class="mt-2 text-sm/6 text-gray-600 dark:text-gray-400">
                    Limits cannot be changed after creation
                  </p>
                }
              </div>

              <!-- Daily Cost Limit (Optional) -->
              <div>
                <label for="dailyCostLimit" class="block text-sm/6 font-medium text-gray-700 dark:text-gray-300">
                  Daily Cost Limit (USD) <span class="text-gray-500 text-xs/5">(Optional)</span>
                </label>
                <input
                  type="number"
                  id="dailyCostLimit"
                  formControlName="dailyCostLimit"
                  step="0.01"
                  min="0"
                  placeholder="0.00"
                  [disabled]="isEditMode()"
                  class="mt-1 block w-full rounded-sm border border-gray-300 bg-white px-3 py-2 text-sm/6 text-gray-900 placeholder:text-gray-400 focus:border-blue-500 focus:outline-hidden focus:ring-3 focus:ring-blue-500/50 disabled:cursor-not-allowed disabled:bg-gray-50 disabled:text-gray-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:placeholder:text-gray-500 dark:disabled:bg-gray-800"
                />
                @if (overrideForm.controls.dailyCostLimit.invalid && overrideForm.controls.dailyCostLimit.touched) {
                  <p class="mt-2 text-sm/6 text-red-600 dark:text-red-400">Daily cost limit must be 0 or greater</p>
                }
              </div>
            </div>
          }
        </div>
      </div>

      <!-- Valid Period -->
      <div class="rounded-sm border border-gray-200 bg-white p-6 dark:border-gray-700 dark:bg-gray-800">
        <h2 class="mb-6 text-lg/7 font-semibold text-gray-900 dark:text-white">Valid Period</h2>

        <div class="grid grid-cols-1 gap-6 md:grid-cols-2">
          <!-- Valid From -->
          <div>
            <label for="validFrom" class="block text-sm/6 font-medium text-gray-700 dark:text-gray-300">
              Valid From <span class="text-red-500">*</span>
            </label>
            <input
              type="datetime-local"
              id="validFrom"
              formControlName="validFrom"
              [disabled]="isEditMode()"
              class="mt-1 block w-full rounded-sm border border-gray-300 bg-white px-3 py-2 text-sm/6 text-gray-900 focus:border-blue-500 focus:outline-hidden focus:ring-3 focus:ring-blue-500/50 disabled:cursor-not-allowed disabled:bg-gray-50 disabled:text-gray-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:disabled:bg-gray-800"
            />
            @if (overrideForm.controls.validFrom.invalid && overrideForm.controls.validFrom.touched) {
              <p class="mt-2 text-sm/6 text-red-600 dark:text-red-400">Start date is required</p>
            }
            @if (isEditMode()) {
              <p class="mt-2 text-sm/6 text-gray-600 dark:text-gray-400">Start date cannot be changed</p>
            }
          </div>

          <!-- Valid Until -->
          <div>
            <label for="validUntil" class="block text-sm/6 font-medium text-gray-700 dark:text-gray-300">
              Valid Until <span class="text-red-500">*</span>
            </label>
            <input
              type="datetime-local"
              id="validUntil"
              formControlName="validUntil"
              class="mt-1 block w-full rounded-sm border border-gray-300 bg-white px-3 py-2 text-sm/6 text-gray-900 focus:border-blue-500 focus:outline-hidden focus:ring-3 focus:ring-blue-500/50 dark:border-gray-600 dark:bg-gray-700 dark:text-white"
            />
            @if (overrideForm.controls.validUntil.invalid && overrideForm.controls.validUntil.touched) {
              <p class="mt-2 text-sm/6 text-red-600 dark:text-red-400">End date is required</p>
            }
            <p class="mt-2 text-sm/6 text-gray-600 dark:text-gray-400">
              You can extend the expiry date by editing the override
            </p>
          </div>
        </div>
      </div>

      <!-- Reason & Status -->
      <div class="rounded-sm border border-gray-200 bg-white p-6 dark:border-gray-700 dark:bg-gray-800">
        <h2 class="mb-6 text-lg/7 font-semibold text-gray-900 dark:text-white">Reason & Status</h2>

        <div class="space-y-6">
          <!-- Reason -->
          <div>
            <label for="reason" class="block text-sm/6 font-medium text-gray-700 dark:text-gray-300">
              Reason <span class="text-red-500">*</span>
            </label>
            <textarea
              id="reason"
              formControlName="reason"
              rows="3"
              placeholder="Explain why this override is needed..."
              class="mt-1 block w-full rounded-sm border border-gray-300 bg-white px-3 py-2 text-sm/6 text-gray-900 placeholder:text-gray-400 focus:border-blue-500 focus:outline-hidden focus:ring-3 focus:ring-blue-500/50 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:placeholder:text-gray-500"
            ></textarea>
            @if (overrideForm.controls.reason.invalid && overrideForm.controls.reason.touched) {
              <p class="mt-2 text-sm/6 text-red-600 dark:text-red-400">Reason is required</p>
            }
            <p class="mt-2 text-sm/6 text-gray-600 dark:text-gray-400">
              Provide context for why this override was created (e.g., special project, testing, emergency)
            </p>
          </div>

          <!-- Enabled (Edit mode only) -->
          @if (isEditMode()) {
            <div>
              <label class="flex items-center">
                <input
                  type="checkbox"
                  formControlName="enabled"
                  class="size-4 rounded-xs border-gray-300 text-blue-600 focus:ring-3 focus:ring-blue-500/50 dark:border-gray-600 dark:bg-gray-700"
                />
                <span class="ml-3">
                  <span class="block text-sm/6 font-medium text-gray-900 dark:text-white">Enable this override</span>
                  <span class="block text-sm/6 text-gray-600 dark:text-gray-400">
                    Disabled overrides will not be applied to quota resolution
                  </span>
                </span>
              </label>
            </div>
          }
        </div>
      </div>

      <!-- Form Actions -->
      <div class="flex justify-end gap-3">
        <button
          type="button"
          (click)="onCancel()"
          [disabled]="isSubmitting()"
          class="rounded-sm border border-gray-300 bg-white px-4 py-2 text-sm/6 font-medium text-gray-700 hover:bg-gray-50 focus:outline-hidden focus:ring-3 focus:ring-gray-500/50 disabled:cursor-not-allowed disabled:opacity-50 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600"
        >
          Cancel
        </button>
        <button
          type="submit"
          [disabled]="overrideForm.invalid || isSubmitting()"
          class="inline-flex items-center gap-2 rounded-sm bg-blue-600 px-4 py-2 text-sm/6 font-medium text-white hover:bg-blue-700 focus:outline-hidden focus:ring-3 focus:ring-blue-500/50 disabled:cursor-not-allowed disabled:opacity-50 dark:bg-blue-500 dark:hover:bg-blue-600"
        >
          @if (isSubmitting()) {
            <svg class="size-4 animate-spin" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            Saving...
          } @else {
            @if (isEditMode()) {
              Update Override
            } @else {
              Create Override
            }
          }
        </button>
      </div>
    </form>
  </div>
</div>
